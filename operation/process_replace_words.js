function process_replace_words() {
    var code="# -*- coding: utf-8 -*-<br><br># connect local host MongoDB<br>import json<br>import re<br>from pymongo import UpdateOne<br>from pymongo.errors import InvalidOperation<br>from util import mongo_util<br><br><br># 连接数据库, source_col是collection, dict_col是字典collection<br>db = mongo_util.get_mongo_client('mongodb://0.0.0.0:27017','test')<br># 字典的collection<br>dict_col = 'replace_sources_words'<br># dict 用list只需要读取一次, 更快<br>dict_cursor_all = list(db[dict_col].find())<br>dict_cursor = db[dict_col]<br><br># 待处理数据的collection<br>source_col = 'guidetrip'<br>source_cursor = db[source_col]<br>source_cursor_all = db[source_col].find({'productType':1})<br><br>for i in source_cursor_all:<br>    _id = i['_id']<br>    # 替换数据源文字<br>    for j in dict_cursor_all:<br>        # title<br>        try:<br>            if j['replace_sources_words'] in i['title']:<br>                new_str = i['title'].replace(j['replace_sources_words'],u'马踏飞燕')<br>                try:<br>                    source_cursor.update_one(<br>                        {"_id": _id},<br>                        {<br>                            '$set': {<br>                                'title': new_str<br>                            }<br>                        }<br>                    )<br>                except:<br>                    print 'something error'<br>        except:<br>            print 'id: ' + str(i['_id']) + '\'s \'title\' is wrong'<br>            continue<br>        # name<br>        try:<br>            if j['replace_sources_words'] in i['name']:<br>                _id = i['_id']<br>                new_str = i['name'].replace(j['replace_sources_words'],u'马踏飞燕')<br>                source_cursor.update_one(<br>                        {"_id": _id},<br>                        {<br>                            '$set': {<br>                                'name': new_str<br>                            }<br>                        }<br>                    )<br>        except:<br>            print 'id: ' + str(i['_id']) + '\'s \'name\' is wrong'<br>            continue<br>        # description<br>        try:<br>            if j['replace_sources_words'] in i['description']:<br>                new_str = i['description'].replace(j['replace_sources_words'],u'马踏飞燕')<br>                try:<br>                    source_cursor.update_one(<br>                        {"_id": _id},<br>                        {<br>                            '$set': {<br>                                'description': new_str<br>                            }<br>                        }<br>                    )<br>                except:<br>                    print 'something error'<br>        except:<br>            print 'id: ' + str(i['_id']) + '\'s \'description\' is wrong'<br>            continue<br><br>    # 替换微信和QQ, 手机号码<br>    if u'微信' in i['description']:<br>        i['description'].replace('\r\n','\n')<br>        print i['description']<br>        print i['_id']<br>        print '======================================='<br>        for j in i['description'].split('\n'):<br>            print j<br>            print '******'<br>        print '--------------------'<br>        m = re.findall(r"\+?\d{5,}",i['description'])<br>        if m:<br>            for j in n:<br>                new_str = i['description'].replace(j,u' 欢迎使用马踏飞燕app下订单,付款后可见')<br>                try:<br>                    source_cursor.update_one(<br>                        {"_id": _id},<br>                        {<br>                            '$set': {<br>                                'description': new_str<br>                            }<br>                        }<br>                    )<br>                except:<br>                    print 'update index 4 error'<br><br>        n = re.findall(r"[a-zA-Z]+[\d \_ \w]{4,}",i['description'])<br>        if n:<br>            for j in n:<br>                new_str = i['description'].replace(j,u' 欢迎使用马踏飞燕app下订单,付款后可见')<br>                try:<br>                    source_cursor.update_one(<br>                        {"_id": _id},<br>                        {<br>                            '$set': {<br>                                'description': new_str<br>                            }<br>                        }<br>                    )<br>                except:<br>                    print 'update index 5 error'<br><br>            print i['description']<br> ";
    return code;}
